# =========================
# Pleading Sanity â€” Netlify
# Static site: HTML/CSS/JS at repo root
# =========================

[build]
  publish = "."            # serve files from repo root
  command = ""             # no build step

[build.environment]
  NODE_VERSION = "22.18.0"

# ---------- Plugins (safe) ----------
# Minify HTML (small, safe speed win)
[[plugins]]
  package = "netlify-plugin-minify-html"

# Inline critical CSS (fast first paint)
[[plugins]]
  package = "netlify-plugin-inline-critical-css"

# Optional: HTML validation during deploy (non-fatal)
[[plugins]]
  package = "netlify-plugin-html-validate"

# Optional: Link checker (warns on broken links; non-fatal)
[[plugins]]
  package = "netlify-plugin-checklinks"

# NOTE: Avoid exotic plugins that might break deploys.
# Image optim happens via Netlify CDN; extra plugins not required.

# ---------- Routing ----------
# We are NOT adding a SPA catch-all redirect so your multi-page site works:
#   /movement.html, /shop.html, /kids.html, /404.html load directly.
# If you later switch to a single-page app router, add:
# [[redirects]]
#   from = "/*"
#   to = "/index.html"
#   status = 200

# Nice-to-have: redirect old /index to root (just in case)
[[redirects]]
  from = "/index"
  to = "/"
  status = 301
  force = true

# ---------- Caching ----------
# Long cache for static assets (images, icons, media)
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=604800, immutable"  # 7 days, fingerprint-friendly

# Short cache for HTML so updates go live fast
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=60"                  # 1 minute

# ---------- Security Headers ----------
[[headers]]
  for = "/*"
  [headers.values]
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    X-Frame-Options           = "SAMEORIGIN"
    X-Content-Type-Options    = "nosniff"
    Referrer-Policy           = "strict-origin-when-cross-origin"
    Permissions-Policy        = "camera=(), microphone=(), geolocation=(), interest-cohort=()"
    # CSP: generous enough for YouTube-nocookie + TikTok embeds, mailto links
    # If you later add analytics (e.g., Plausible), whitelist its domain here.
    Content-Security-Policy   = """
      default-src 'self';
      script-src 'self' https://www.tiktok.com https://*.tiktokcdn.com 'unsafe-inline';
      style-src  'self' 'unsafe-inline';
      img-src    'self' data: https://i.ytimg.com https://*.tiktokcdn.com https://images.unsplash.com;
      frame-src  https://www.youtube-nocookie.com https://www.tiktok.com;
      connect-src 'self';
      font-src   'self' data:;
      media-src  'self' https://*.tiktokcdn.com;
      object-src 'none';
      base-uri   'self';
      form-action 'self' https://api.netlify.com;
    """

# ---------- MIME fixes (just in case for icons/webmanifest) ----------
[[headers]]
  for = "/site.webmanifest"
  [headers.values]
    Content-Type = "application/manifest+json; charset=utf-8"

[[headers]]
  for = "/assets/icons/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"
